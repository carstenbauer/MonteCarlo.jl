<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Measurements · MonteCarlo.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="MonteCarlo.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit">MonteCarlo.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Introduction</a></li><li><span class="tocitem">DQMC</span><ul><li><a class="tocitem" href="../Introduction/">Introduction</a></li><li><a class="tocitem" href="../model/">Model</a></li><li><a class="tocitem" href="../lattice/">Lattices</a></li><li><a class="tocitem" href="../dqmc/">DQMC</a></li><li><a class="tocitem" href="../recorder/">Configuration Recorder</a></li><li><a class="tocitem" href="../scheduler/">Update Scheduler</a></li><li class="is-active"><a class="tocitem" href>Measurements</a><ul class="internal"><li><a class="tocitem" href="#General-Notes-1"><span>General Notes</span></a></li></ul></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../examples/triangular_Hubbard/">Triangular Attractive Hubbard</a></li><li><a class="tocitem" href="../../examples/ALF1/">Crosscheck with ALF</a></li><li><a class="tocitem" href="../../examples/HofmannBergChowdhury/">Topological Flat Band Model</a></li></ul></li><li><span class="tocitem">Legacy</span><ul><li><a class="tocitem" href="../../legacy/">Introduction</a></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Manual</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../legacy/manual/gettingstarted/">Getting started</a></li><li><a class="tocitem" href="../../legacy/manual/showcase/">Showcase</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-3" type="checkbox"/><label class="tocitem" for="menuitem-4-3"><span class="docs-label">Physical models</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../legacy/models/ising/">Ising model</a></li><li><a class="tocitem" href="../../legacy/models/hubbardattractive/">Attractive Hubbard model</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-4" type="checkbox"/><label class="tocitem" for="menuitem-4-4"><span class="docs-label">Monte Carlo flavors</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../legacy/flavors/mc/">MC</a></li><li><a class="tocitem" href="../../legacy/flavors/dqmc/">DQMC</a></li></ul></li><li><a class="tocitem" href="../../legacy/lattices/">Lattices</a></li><li><a class="tocitem" href="../../legacy/customize/">Customize</a></li><li><input class="collapse-toggle" id="menuitem-4-7" type="checkbox"/><label class="tocitem" for="menuitem-4-7"><span class="docs-label">Interfaces</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../legacy/interfaces/MC/">MC</a></li><li><a class="tocitem" href="../../legacy/interfaces/DQMC/">DQMC</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-8" type="checkbox"/><label class="tocitem" for="menuitem-4-8"><span class="docs-label">General exports</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../legacy/methods/general/">General</a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">DQMC</a></li><li class="is-active"><a href>Measurements</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Measurements</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/carstenbauer/MonteCarlo.jl/blob/master/docs/src/DQMC/measurements.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Measurements-1"><a class="docs-heading-anchor" href="#Measurements-1">Measurements</a><a class="docs-heading-anchor-permalink" href="#Measurements-1" title="Permalink"></a></h1><p>Measurements in DQMC primarily rely on (Wick&#39;s theorem)[https://en.wikipedia.org/wiki/Wick%27s<em>theorem] to express observables in terms of Greens function elements. The greens function in DQMC is a matrix G</em>{ij}(k, l) = \langle c<em>i(k \Delta\tau) c</em>j^\dagger(l \Delta\tau)\rangle<em>f$, where \langle\cdot\rangle</em>f$ represents the fermion average. </p><p>Measurement are created and added via <code>dqmc[:name] = measurement(dqmc, model)</code>. The currently implemented measurements are the following</p><h4 id="Greens-1"><a class="docs-heading-anchor" href="#Greens-1">Greens</a><a class="docs-heading-anchor-permalink" href="#Greens-1" title="Permalink"></a></h4><p>The equal time greens function can be measured via <code>greens_measurement(dqmc, model)</code>. The measurement will take the Monte Carlo or bosonic average of <code>greens(dqmc, model)</code>.</p><h4 id="Occupation-1"><a class="docs-heading-anchor" href="#Occupation-1">Occupation</a><a class="docs-heading-anchor-permalink" href="#Occupation-1" title="Permalink"></a></h4><p>The per-site occupation <span>$\langle n_i \rangle$</span> can be measured via <code>occupation(dqmc, model)</code>. This will average <span>$1 - G_{ii}$</span>.</p><h4 id="Charge-Density-1"><a class="docs-heading-anchor" href="#Charge-Density-1">Charge Density</a><a class="docs-heading-anchor-permalink" href="#Charge-Density-1" title="Permalink"></a></h4><p>The charge density correlation <span>$\langle \sum_r n(r) n(r+\Delta r) \rangle$</span> can be measured with <code>charge_density_correlation(dqmc, model)</code>. The time integral of that, the charge density susceptibility can be measure with <code>charge_density_susceptibility(mc, model)</code>.  Note that either way the result will be averaged over origin sites and saved by distance vectors. These vectors can be generated with <code>directions(lattice)</code></p><h4 id="Magnetization-1"><a class="docs-heading-anchor" href="#Magnetization-1">Magnetization</a><a class="docs-heading-anchor-permalink" href="#Magnetization-1" title="Permalink"></a></h4><p><code>magnetization(dqmc, model, dir::Symbol)</code> measures the per-site x-, y- or z-magnetizations.</p><h4 id="Spin-Density-1"><a class="docs-heading-anchor" href="#Spin-Density-1">Spin Density</a><a class="docs-heading-anchor-permalink" href="#Spin-Density-1" title="Permalink"></a></h4><p>The spin density correlation <span>$\langle S_\gamma S_\gamma \rangle$</span> in x-, y- or z-direction can be measured with <code>spin_density_correlation(dqmc, model, dir::Symbol)</code>. The respective susceptibilities follow from <code>spin_density_susceptibility(dqmc, model, dir)</code>.</p><h4 id="Pairing-1"><a class="docs-heading-anchor" href="#Pairing-1">Pairing</a><a class="docs-heading-anchor-permalink" href="#Pairing-1" title="Permalink"></a></h4><p>The pairing susceptibility <span>$\Delta_v(s_1, t_1)(\tau) \Delta_v^\dagger(s_2, t_2)(0)$</span> can be calculated with <code>pairing_susceptibility(dqmc, model)</code>. The <span>$\tau = 0$</span> pairing correlation follows from <code>pairing_correlation(dqmc, model)</code>.</p><h4 id="Current-Current-Susceptibility-1"><a class="docs-heading-anchor" href="#Current-Current-Susceptibility-1">Current-Current Susceptibility</a><a class="docs-heading-anchor-permalink" href="#Current-Current-Susceptibility-1" title="Permalink"></a></h4><p><code>current_current_susceptibility(dqmc, model)</code> measures <span>$\langle j_{t_2 - s_2}(s_2, l) j_{t_1 - s_1}(s_1, 0)\rangle$ with $j_{t - s}(s, \tau) = \langle i \sum_\sigma [T_{ts} c_t^\dagger(\tau) c_s(\tau) - T_{st} c_s^\dagger(\tau) c_t(\tau)] \rangle$</span> where <span>$i^2 = -1$</span> and <span>$T$</span> is the hopping matrix.</p><h4 id="Superfluid-Density-1"><a class="docs-heading-anchor" href="#Superfluid-Density-1">Superfluid Density</a><a class="docs-heading-anchor-permalink" href="#Superfluid-Density-1" title="Permalink"></a></h4><p><code>superfluid_density(dqmc, model, L)</code> computes the superfluid density using the current current susceptibility for a lattice of linear system size <span>$L$</span>.</p><h4 id="Energies-1"><a class="docs-heading-anchor" href="#Energies-1">Energies</a><a class="docs-heading-anchor-permalink" href="#Energies-1" title="Permalink"></a></h4><p>The energy can be measured with <code>total_energy(dqmc, model)</code>. The interacting and noninteracting parts can be measured independently with <code>interacting_energy(dqmc, model)</code> and <code>noninteracting_energy(dqmc, model)</code></p><h2 id="General-Notes-1"><a class="docs-heading-anchor" href="#General-Notes-1">General Notes</a><a class="docs-heading-anchor-permalink" href="#General-Notes-1" title="Permalink"></a></h2><p>All measurements are implemented via</p><pre><code class="language-julia">struct DQMCMeasurement{GI, LI, F &lt;: Function, OT, T} &lt;: AbstractMeasurement
    greens_iterator::GI
    lattice_iterator::LI
    kernel::F
    observable::OT
    temp::T
end</code></pre><p>The <code>greens_iterator</code> is a type that will be constructed when the simulation starts running. This allows measurements using the same set of greens matrices to be bundled, improving performance especially for unequal time measurements (susceptibilities). There are currently three greens iterators:</p><ul><li><code>Greens</code> which forwards the equal time greens function</li><li><code>GreensAt{k, l}</code> which forwards the result of <code>greens(dqmc, k, l)</code></li><li><code>CombinedGreensIterator</code> which goes through all time slices <code>l = 1 .. M</code> and forwards <span>$G(0, 0)$</span>, <span>$G(0, \Delta\tau l)$</span>, <span>$G(\Delta\tau l, 0)$</span> and <span>$G(\Delta\tau l, \Delta\tau l)$</span>. This implicitly sums results over different time slices and multiplies the result by <span>$\Delta\tau$</span>, i.e. it implicitly calculates <span>$O_{idxs} = \int_0^\beta O_{idxs}(\tau) d\tau$</span>.</li></ul><p>The <code>lattice_iterator</code> is also (usually) a type with deferred construction. This iterator generates site indices which are ultimately passed on to the <code>kernel</code> with the Greens matrices generated by <code>greens_iterator</code>. The iterators are given on the lattice page. Depending on the iterator in use, there may be some implicit summation:</p><ul><li><code>DirectLatticeIterator</code>s do not perform summation, i.e. the indices <code>idxs...</code> are used as <code>temp[idxs...] = kernel(..., idxs..., ...)</code></li><li><code>DeferredLatticeIterator</code>s return directional indices which are used to index the output and site indices which are passed to <code>kernel</code>. This means there is an implicit summation here, which reduces a all site indices to directional indices. The result is then normalized by dividing by the number of summed results, which is the number of sites.</li><li><code>Sum{&lt;: LatticeIterator}</code> explicitly sums all kernel results. This will also apply normalizations of the wrapped iterator if it has any.</li><li><code>ApplySymmetries{&lt;: DeferredLatticeIterator}</code> performs the summation and normalization of the wrapped iterator, and then applies the symmetry weights to the second or second and third directional indices and sums up the result. This leaves the an array with one directional index.</li></ul><p>The <code>kernel</code> is a function that basically just applies the results from Wicks theorem. For example, the kernel for charge density susceptibilities is given by</p><pre><code class="language-julia">function cdc_kernel(mc, model, ij::NTuple{2}, packed_greens::NTuple{4})
    i, j = ij
	G00, G0l, Gl0, Gll = packed_greens
    N = length(lattice(mc))

    # ⟨n↑(l)n↑⟩
    (1 - Gll[i, i]) * (1 - G00[j, j]) -
    G0l[j, i] * Gl0[i, j] +
    # ⟨n↑(l)n↓⟩
    (1 - Gll[i, i]) * (1 - G00[j+N, j+N]) -
    G0l[j+N, i] * Gl0[i, j+N] +
    # ⟨n↓(l)n↑⟩
    (1 - Gll[i+N, i+N]) * (1 - G00[j, j]) -
    G0l[j, i+N] * Gl0[i+N, j] +
    # ⟨n↓(l)n↓⟩
    (1 - Gll[i+N, i+N]) * (1 - G00[j+N, j+N]) -
    G0l[j+N, i+N] * Gl0[i+N, j+N]
end</code></pre><p>The passed indices and greens matrices vary depending on the chosen iterators. The indices could be a single integer, a tuple of two or a tuple of four integers. <code>packed_greens</code> could be a greens matrix (which could be a special matrix type like <code>BlockDiagonal</code>) or a tuple of four greens matrices.</p><p>The <code>observable</code> is the final storage of the measured values. By default this is a <code>LogBinner</code> from <code>BinningAnalysis.jl</code> but that can be changed. The only hard requirement is that the data structure implements <code>push!</code>. The shape and type of the values pushed to the container can be derived from the greens element type returned by <code>geltype(dqmc)</code> and the shape tuple returned by <code>_get_final_shape(dqmc, model, lattice_iterator)</code>.</p><p>The <code>temp</code> field is a temporary storage Array used as a target for summation before pushing the final result of the measurement. It should be initialized to </p><pre><code class="language-julia">temp = let
    shape = _get_temp_shape(dqmc, _model, lattice_iterator)
    shape === nothing ? nothing : Array{geltype(dqmc)}(undef, shape)
end</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../scheduler/">« Update Scheduler</a><a class="docs-footer-nextpage" href="../../examples/triangular_Hubbard/">Triangular Attractive Hubbard »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Friday 10 December 2021 11:40">Friday 10 December 2021</span>. Using Julia version 1.6.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
