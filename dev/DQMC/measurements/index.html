<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Measurements · MonteCarlo.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="MonteCarlo.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit">MonteCarlo.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Introduction</a></li><li><span class="tocitem">DQMC</span><ul><li><a class="tocitem" href="../Introduction/">Introduction</a></li><li><a class="tocitem" href="../model/">Model</a></li><li><a class="tocitem" href="../lattice/">Lattices</a></li><li><a class="tocitem" href="../fields/">Fields</a></li><li><a class="tocitem" href="../dqmc/">DQMC</a></li><li><a class="tocitem" href="../recorder/">Configuration Recorder</a></li><li><a class="tocitem" href="../scheduler/">Update Scheduler</a></li><li class="is-active"><a class="tocitem" href>Measurements</a><ul class="internal"><li><a class="tocitem" href="#Construction-Measurements-1"><span>Construction Measurements</span></a></li><li><a class="tocitem" href="#General-Notes-1"><span>General Notes</span></a></li></ul></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../examples/triangular_Hubbard/">Triangular Attractive Hubbard</a></li><li><a class="tocitem" href="../../examples/ALF1/">Crosscheck with ALF</a></li><li><a class="tocitem" href="../../examples/HofmannBergChowdhury/">Topological Flat Band Model</a></li></ul></li><li><span class="tocitem">Legacy</span><ul><li><a class="tocitem" href="../../legacy/">Introduction</a></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Manual</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../legacy/manual/gettingstarted/">Getting started</a></li><li><a class="tocitem" href="../../legacy/manual/showcase/">Showcase</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-3" type="checkbox"/><label class="tocitem" for="menuitem-4-3"><span class="docs-label">Physical models</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../legacy/models/ising/">Ising model</a></li><li><a class="tocitem" href="../../legacy/models/hubbardattractive/">Attractive Hubbard model</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-4" type="checkbox"/><label class="tocitem" for="menuitem-4-4"><span class="docs-label">Monte Carlo flavors</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../legacy/flavors/mc/">MC</a></li><li><a class="tocitem" href="../../legacy/flavors/dqmc/">DQMC</a></li></ul></li><li><a class="tocitem" href="../../legacy/lattices/">Lattices</a></li><li><a class="tocitem" href="../../legacy/customize/">Customize</a></li><li><input class="collapse-toggle" id="menuitem-4-7" type="checkbox"/><label class="tocitem" for="menuitem-4-7"><span class="docs-label">Interfaces</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../legacy/interfaces/MC/">MC</a></li><li><a class="tocitem" href="../../legacy/interfaces/DQMC/">DQMC</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-8" type="checkbox"/><label class="tocitem" for="menuitem-4-8"><span class="docs-label">General exports</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../legacy/methods/general/">General</a></li></ul></li></ul></li><li><span class="tocitem">DQMC Dev Docs</span><ul><li><a class="tocitem" href="../../devdocs/model_field/">Models and Fields</a></li><li><a class="tocitem" href="../../devdocs/dqmc_stacks/">DQMC Stacks</a></li><li><a class="tocitem" href="../../devdocs/measurements/">Measurements</a></li><li><a class="tocitem" href="../../devdocs/linalg/">Linear Algebra</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">DQMC</a></li><li class="is-active"><a href>Measurements</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Measurements</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/carstenbauer/MonteCarlo.jl/blob/master/docs/src/DQMC/measurements.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Measurements-1"><a class="docs-heading-anchor" href="#Measurements-1">Measurements</a><a class="docs-heading-anchor-permalink" href="#Measurements-1" title="Permalink"></a></h1><h2 id="Construction-Measurements-1"><a class="docs-heading-anchor" href="#Construction-Measurements-1">Construction Measurements</a><a class="docs-heading-anchor-permalink" href="#Construction-Measurements-1" title="Permalink"></a></h2><p>Measurement are created and added to a Simulation via <code>dqmc[:name] = measurement(dqmc, model)</code>. Various properties of the measurement can be adjusted via keyword arguments, such as the lattice iteration scheme or the Wicks expanded expectation value. This will be discussed in more detail later.</p><p>The currently implemented measurements are the following:</p><h3 id="Greens-1"><a class="docs-heading-anchor" href="#Greens-1">Greens</a><a class="docs-heading-anchor-permalink" href="#Greens-1" title="Permalink"></a></h3><p>The equal time greens function can be measured via <code>greens_measurement(dqmc, model)</code>. The measurement will take the Monte Carlo average of <code>greens(dqmc, model)</code>.</p><h3 id="Occupation-1"><a class="docs-heading-anchor" href="#Occupation-1">Occupation</a><a class="docs-heading-anchor-permalink" href="#Occupation-1" title="Permalink"></a></h3><p>The per-site occupation <span>$\langle n_i \rangle$</span> can be measured via <code>occupation(dqmc, model)</code>. This will average <span>$1 - G_{ii}$</span>.</p><h3 id="Charge-Density-1"><a class="docs-heading-anchor" href="#Charge-Density-1">Charge Density</a><a class="docs-heading-anchor-permalink" href="#Charge-Density-1" title="Permalink"></a></h3><p>The charge density correlation <span>$\langle \sum_r n(r) n(r+\Delta r) \rangle$</span> can be measured with <code>charge_density_correlation(dqmc, model)</code>. The time integral of that, the charge density susceptibility can be measure with <code>charge_density_susceptibility(mc, model)</code>.</p><p>Note that you can also pass <code>kernel = MonteCarlo.reduced_cdc_kernel</code> to measure just the correlated part, i.e. <span>$\langle \sum_r n(r) n(r+\Delta r) \rangle - \langle n(r) \rangle \langle n(r+\Delta r) \rangle$</span> instead.</p><h3 id="Magnetization-1"><a class="docs-heading-anchor" href="#Magnetization-1">Magnetization</a><a class="docs-heading-anchor-permalink" href="#Magnetization-1" title="Permalink"></a></h3><p><code>magnetization(dqmc, model, dir::Symbol)</code> measures the per-site x-, y- or z-magnetizations.</p><h3 id="Spin-Density-1"><a class="docs-heading-anchor" href="#Spin-Density-1">Spin Density</a><a class="docs-heading-anchor-permalink" href="#Spin-Density-1" title="Permalink"></a></h3><p>The spin density correlation <span>$\langle S_\gamma S_\gamma \rangle$</span> in x-, y- or z-direction can be measured with <code>spin_density_correlation(dqmc, model, dir::Symbol)</code>. The respective susceptibilities follow from <code>spin_density_susceptibility(dqmc, model, dir)</code>.</p><p>Like with charge density there are additional kernels that only measure the correlated part of the spin density. Use <code>kernel = MonteCarlo.reduced_sdc_γ_kernel</code> with <span>$\gamma \in {x, y, z}$</span> for the respective direction.</p><h3 id="Pairing-1"><a class="docs-heading-anchor" href="#Pairing-1">Pairing</a><a class="docs-heading-anchor-permalink" href="#Pairing-1" title="Permalink"></a></h3><p>The pairing susceptibility <span>$\Delta_v(s_1, t_1)(\tau) \Delta_v^\dagger(s_2, t_2)(0)$</span> can be calculated with <code>pairing_susceptibility(dqmc, model)</code>. The <span>$\tau = 0$</span> pairing correlation follows from <code>pairing_correlation(dqmc, model)</code>.</p><h3 id="Current-Current-Susceptibility-1"><a class="docs-heading-anchor" href="#Current-Current-Susceptibility-1">Current-Current Susceptibility</a><a class="docs-heading-anchor-permalink" href="#Current-Current-Susceptibility-1" title="Permalink"></a></h3><p><code>current_current_susceptibility(dqmc, model)</code> measures <span>$\langle j_{t_2 - s_2}(s_2, l) j_{t_1 - s_1}(s_1, 0)\rangle$</span> with <span>$j_{t - s}(s, \tau) = \langle i \sum_\sigma [T_{ts} c_t^\dagger(\tau) c_s(\tau) - T_{st} c_s^\dagger(\tau) c_t(\tau)] \rangle$</span> where <span>$i^2 = -1$</span> and <span>$T$</span> is the hopping matrix.</p><h3 id="Superfluid-Density-1"><a class="docs-heading-anchor" href="#Superfluid-Density-1">Superfluid Density</a><a class="docs-heading-anchor-permalink" href="#Superfluid-Density-1" title="Permalink"></a></h3><p>The superfluid density can be derived from the current-current susceptibility and the Greens function. <a href="https://github.com/ffreyer/MonteCarloAnalysis">MonteCarloAnalysis.jl</a> provides functionality for that.</p><h3 id="Energies-1"><a class="docs-heading-anchor" href="#Energies-1">Energies</a><a class="docs-heading-anchor-permalink" href="#Energies-1" title="Permalink"></a></h3><p>The energy can be measured with <code>total_energy(dqmc, model)</code>. The interacting and hopping parts can be measured independently with <code>interaction_energy(dqmc, model)</code> and <code>kinetic_energy(dqmc, model)</code></p><h2 id="General-Notes-1"><a class="docs-heading-anchor" href="#General-Notes-1">General Notes</a><a class="docs-heading-anchor-permalink" href="#General-Notes-1" title="Permalink"></a></h2><p>All measurements are implemented via</p><pre><code class="language-julia">struct DQMCMeasurement{F &lt;: Function, GI, LI, FI, OT, T} &lt;: AbstractMeasurement
    greens_iterator::GI
    lattice_iterator::LI
    flavor_iterator::FI
    kernel::F
    observable::OT
    temp::T
end</code></pre><h4 id="kernel-1"><a class="docs-heading-anchor" href="#kernel-1"><code>kernel</code></a><a class="docs-heading-anchor-permalink" href="#kernel-1" title="Permalink"></a></h4><p>The auxiliary field dependent greens function is readily available at any point in the simulation. As such it is the object on which measurements typically rely on. Using <a href="https://en.wikipedia.org/wiki/Wick%27s_theorem">Wick&#39;s theorem</a> most expectation values can be expressed in terms of greens function elements <span>$G_{ij}(k, l) = \langle c_i(k \Delta\tau) c_j^\dagger(l \Delta\tau)\rangle$</span> where <span>$i, j$</span> represent sites and flavors (spins), and <span>$k, l$</span> represent imaginary time. The <code>kernel</code> implements this expanded form. </p><p>For example, the <code>full_cdc_kernel</code> implementing <span>$\langle \sum_r n(r) n(r+\Delta r) \rangle$</span> looks like this:</p><pre><code class="language-julia">@inline Base.@propagate_inbounds function full_cdc_kernel(
        mc, ::Model, ij::NTuple{2}, packed_greens::_GM4{&lt;: Matrix}, flv
    )
    i, j = ij
    f1, f2 = flv
	G00, G0l, Gl0, Gll = packed_greens
    N = length(lattice(mc))
    
    id = I[i, j] * I[G0l.k, G0l.l] * I[f1, f2]
    s1 = N * (f1 - 1)
    s2 = N * (f2 - 1)

    # ⟨n_{σ₁}(l) n_{σ₂}(0)⟩ =
    #   ⟨n_{σ₁}(l)⟩ ⟨n_{σ₂}(0)⟩ + 
    #   ⟨c_{σ₁}^†(l) c_{σ₂}(0)⟩ ⟨c_{σ₁}(l) c_{σ₂}^†(0)⟩ =
    return (1 - Gll.val[i+s1, i+s1]) * (1 - G00.val[j+s2, j+s2]) +
            (id - G0l.val[j+s1, i+s2]) * Gl0.val[i+s1, j+s2]
end</code></pre><p>Here <code>i, j = ij</code> are site indices representing <span>$r, r + \Delta r$</span> coming from the lattice iterator, <code>G00, G0l, Gl0, Gll = packed_greens</code> are Greens matrices at different imaginary times coming from the greens iterator, and <code>f1, f2 = flv</code> are flavor (spin) indices coming from the flavor iterator. The result of the kernel is the charge density expectation value for a specific set of those indices.</p><p>These functions generally have a specialized methods implemented for the different matrix types that are used in DQMC. You can check the source code under &quot;flavors/DQMC/measurements/constructors&quot; for more examples. </p><h3 id="greens_iterator-1"><a class="docs-heading-anchor" href="#greens_iterator-1"><code>greens_iterator</code></a><a class="docs-heading-anchor-permalink" href="#greens_iterator-1" title="Permalink"></a></h3><p>The <code>greens_iterator</code> controls which Greens functions are passed on to the kernel. Internally measurements that use the same <code>greens_iterator</code> will be bundled to avoid expensive recalculations. The available iterators include:</p><ul><li><code>nothing</code> specifies that no Greens function is needed</li><li><code>Greens()</code> forwards the equal time greens function <code>G(0, 0)</code> (which matches all other equal time greens functions)</li><li><code>GreensAt(k, l)</code> forwards the result of <code>greens(dqmc, k, l)</code>, i.e. a greens function at the specific time indices <span>$k, l$</span>.</li><li><code>TimeIntegral([recalculate = 2 mc.parameters.safe_mult])</code> creates an iterator for calculating imaginary time integral of the form <span>$O_i = \int_0^\beta O_(\tau) d\tau$</span> as <span>$O_i \approx \sum_{l = 0}^{M-1} 0.5 \Delta\tau (O_(l \Delta\tau) + O_((l+1) \Delta\tau))$</span>. In every step this iterator will generate four greens matrices <span>$G(0, 0)$</span>, <span>$G(0, l\Delta\tau)$</span>, <span>$G(l\Delta\tau, 0)$</span>, <span>$G(l\Delta\tau, l\Delta\tau)$</span>. This internally uses <code>CombinedGreensIterator(mc[; start, stop, recalculate])</code> to generate these matrices.</li></ul><h3 id="lattice_iterator-1"><a class="docs-heading-anchor" href="#lattice_iterator-1"><code>lattice_iterator</code></a><a class="docs-heading-anchor-permalink" href="#lattice_iterator-1" title="Permalink"></a></h3><p>The <code>lattice_iterator</code> controls which combination of site indices are passed to the kernel and how they are further combined before saving the measurements. For example, <code>EachSitePairByDistance</code> passes any combination of two sites indices to the kernel and sums up site pairs which have the same distance between them. See the Lattices section for more detail.</p><h3 id="flavor_iterator-1"><a class="docs-heading-anchor" href="#flavor_iterator-1"><code>flavor_iterator</code></a><a class="docs-heading-anchor-permalink" href="#flavor_iterator-1" title="Permalink"></a></h3><p>The <code>flavor_iterator</code> similarly specifies which flavor (spin) indices should be iterated. This is primarily an optimization used to pull a flavor sum out of the kernel. Note that this is not always possible/useful, so some measurements may not use this iterator even though multiple flavors are involved. As such this iterator should generally not be adjusted.</p><h3 id="observable-1"><a class="docs-heading-anchor" href="#observable-1"><code>observable</code></a><a class="docs-heading-anchor-permalink" href="#observable-1" title="Permalink"></a></h3><p>The <code>observable</code> is the final storage of the measured values. By default this is a <code>LogBinner</code> from <code>BinningAnalysis.jl</code> but that can be changed. The only hard requirement is that the data structure implements <code>push!</code>. If you want to use your own storage structure you can get a zero element from <code>MonteCarlo._binner_zero_element(dqmc, lattice_iterator, MonteCarlo.geltype(dqmc))</code> if you need it.</p><h3 id="temp-1"><a class="docs-heading-anchor" href="#temp-1"><code>temp</code></a><a class="docs-heading-anchor-permalink" href="#temp-1" title="Permalink"></a></h3><p>The <code>temp</code> field is a temporary storage Array used as a target for summation before pushing the final result of the measurement. It should be initialized with <code>MonteCarlo._measurement_buffer(dqmc, lattice_iterator, geltype(dqmc))</code>. Note that this is often but not always the same as the zero element.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../scheduler/">« Update Scheduler</a><a class="docs-footer-nextpage" href="../../examples/triangular_Hubbard/">Triangular Attractive Hubbard »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Friday 28 April 2023 11:28">Friday 28 April 2023</span>. Using Julia version 1.6.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
