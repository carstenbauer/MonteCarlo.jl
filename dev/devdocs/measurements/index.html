<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Measurements · MonteCarlo.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="MonteCarlo.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit">MonteCarlo.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Introduction</a></li><li><span class="tocitem">DQMC</span><ul><li><a class="tocitem" href="../../DQMC/Introduction/">Introduction</a></li><li><a class="tocitem" href="../../DQMC/model/">Model</a></li><li><a class="tocitem" href="../../DQMC/lattice/">Lattices</a></li><li><a class="tocitem" href="../../DQMC/fields/">Fields</a></li><li><a class="tocitem" href="../../DQMC/dqmc/">DQMC</a></li><li><a class="tocitem" href="../../DQMC/recorder/">Configuration Recorder</a></li><li><a class="tocitem" href="../../DQMC/scheduler/">Update Scheduler</a></li><li><a class="tocitem" href="../../DQMC/measurements/">Measurements</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../examples/triangular_Hubbard/">Triangular Attractive Hubbard</a></li><li><a class="tocitem" href="../../examples/ALF1/">Crosscheck with ALF</a></li><li><a class="tocitem" href="../../examples/HofmannBergChowdhury/">Topological Flat Band Model</a></li></ul></li><li><span class="tocitem">Legacy</span><ul><li><a class="tocitem" href="../../legacy/">Introduction</a></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Manual</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../legacy/manual/gettingstarted/">Getting started</a></li><li><a class="tocitem" href="../../legacy/manual/showcase/">Showcase</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-3" type="checkbox"/><label class="tocitem" for="menuitem-4-3"><span class="docs-label">Physical models</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../legacy/models/ising/">Ising model</a></li><li><a class="tocitem" href="../../legacy/models/hubbardattractive/">Attractive Hubbard model</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-4" type="checkbox"/><label class="tocitem" for="menuitem-4-4"><span class="docs-label">Monte Carlo flavors</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../legacy/flavors/mc/">MC</a></li><li><a class="tocitem" href="../../legacy/flavors/dqmc/">DQMC</a></li></ul></li><li><a class="tocitem" href="../../legacy/lattices/">Lattices</a></li><li><a class="tocitem" href="../../legacy/customize/">Customize</a></li><li><input class="collapse-toggle" id="menuitem-4-7" type="checkbox"/><label class="tocitem" for="menuitem-4-7"><span class="docs-label">Interfaces</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../legacy/interfaces/MC/">MC</a></li><li><a class="tocitem" href="../../legacy/interfaces/DQMC/">DQMC</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-8" type="checkbox"/><label class="tocitem" for="menuitem-4-8"><span class="docs-label">General exports</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../legacy/methods/general/">General</a></li></ul></li></ul></li><li><span class="tocitem">DQMC Dev Docs</span><ul><li><a class="tocitem" href="../model_field/">Models and Fields</a></li><li><a class="tocitem" href="../dqmc_stacks/">DQMC Stacks</a></li><li class="is-active"><a class="tocitem" href>Measurements</a><ul class="internal"><li><a class="tocitem" href="#Measurement-type-1"><span>Measurement type</span></a></li><li><a class="tocitem" href="#Grouping-1"><span>Grouping</span></a></li><li><a class="tocitem" href="#Call-Tree-1"><span>Call Tree</span></a></li><li><a class="tocitem" href="#Restructure-1"><span>Restructure</span></a></li></ul></li><li><a class="tocitem" href="../linalg/">Linear Algebra</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">DQMC Dev Docs</a></li><li class="is-active"><a href>Measurements</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Measurements</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/carstenbauer/MonteCarlo.jl/blob/master/docs/src/devdocs/measurements.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Measurements-1"><a class="docs-heading-anchor" href="#Measurements-1">Measurements</a><a class="docs-heading-anchor-permalink" href="#Measurements-1" title="Permalink"></a></h1><h2 id="Measurement-type-1"><a class="docs-heading-anchor" href="#Measurement-type-1">Measurement type</a><a class="docs-heading-anchor-permalink" href="#Measurement-type-1" title="Permalink"></a></h2><p>Measurements in DQMC are represented with</p><pre><code class="language-julia">struct DQMCMeasurement{F &lt;: Function, GI, LI, FI, OT, T} &lt;: AbstractMeasurement
    greens_iterator::GI
    lattice_iterator::LI
    flavor_iterator::FI
    kernel::F
    observable::OT
    temp::T
end</code></pre><p>where <code>observable</code> is the permanent storage for measurement data and <code>temp</code> is used as temporary storage, i.e. for accumulating data in sums. The iterators specify which greens functions, sites and flavor indices go into a measurement. The kernel is a function that takes all the indices generated for one iteration and returns a measurement value for it. We&#39;ll go into more detail about the latter components when describing the call tree of a measurement, as they match up closely.</p><h2 id="Grouping-1"><a class="docs-heading-anchor" href="#Grouping-1">Grouping</a><a class="docs-heading-anchor-permalink" href="#Grouping-1" title="Permalink"></a></h2><p>In order to efficiently evaluate measurements, we want to avoid recalculating Greens function unnecessarily. Therefore we have a grouping step at the start of the simulation, which groups measurement by their greens iterator. This grouping is done by the <code>generate_groups</code> function in &quot;flavors/DQMC/measurements/generic.jl&quot;. </p><h2 id="Call-Tree-1"><a class="docs-heading-anchor" href="#Call-Tree-1">Call Tree</a><a class="docs-heading-anchor-permalink" href="#Call-Tree-1" title="Permalink"></a></h2><p>The call tree for measurements starts with a call to <code>sweep_once!</code> in &quot;flavors/DQMC/DQMC.jl&quot;. From this point on, all functions down to <code>kernel</code> are implemented in &quot;DQMC/measurements/generic.jl&quot;. Each stage handles one of the iterators of the call tree, with the final one calling the <code>kernel</code>.</p><h3 id="Greens-Iterator-Stage-1"><a class="docs-heading-anchor" href="#Greens-Iterator-Stage-1">Greens Iterator Stage</a><a class="docs-heading-anchor-permalink" href="#Greens-Iterator-Stage-1" title="Permalink"></a></h3><p>The first function in the call tree handles <code>measurement.greens_iterators</code>. A  greens iterators can be:</p><ul><li><code>nothing</code> which implies that the Greens function is not necessary for the measurement and thus none is passed to the next stage.</li><li><code>Greens()</code> which produces the equal-time Greens function and passes it on to the next stage</li><li><code>GreensAt(k, l)</code> which generates a time displaced Greens function <span>$G(k, l) = \langle c(\Delta\tau k) c^\dagger(\Delta\tau l) \rangle$</span> to pass on</li><li><code>TimeIntegral</code> which implies integration over imaginary time, evaluated via a Riemann sum. For each element of the sum, the Greens functions <span>$G(0, 0)$</span>, <span>$G(0, l)$</span>, <span>$G(l, 0)$</span> and <span>$G(l, l)$</span> are generated and passed on to the next stage.</li></ul><p>Since <code>TimeIntegral</code> also includes summation, we prepare <code>measurement.temp</code> at the start of this stage. This is done by the <code>prepare!</code> function. Similarly we end this stage with the <code>finish!</code> function, which applies normalization to the values accumulated in <code>measurement.temp</code> and then <code>push!</code>es them into <code>measurement.observable</code>.</p><h3 id="measure!-Stage-1"><a class="docs-heading-anchor" href="#measure!-Stage-1"><code>measure!</code> Stage</a><a class="docs-heading-anchor-permalink" href="#measure!-Stage-1" title="Permalink"></a></h3><p>This stage only exists to be compliant with the measurement interface.</p><h3 id="Lattice-and-Flavor-Iterator-Stage-1"><a class="docs-heading-anchor" href="#Lattice-and-Flavor-Iterator-Stage-1">Lattice &amp; Flavor Iterator Stage</a><a class="docs-heading-anchor-permalink" href="#Lattice-and-Flavor-Iterator-Stage-1" title="Permalink"></a></h3><p>The lattice and flavor iterators both produce indices for indexing the greens function. You can find details about what each lattice iterator does in the  lattice docs. The iteration implementation is mostly in &quot;lattices/lattice_iterators.jl&quot;, with some of it being in the measurement file. The flavor iterator is a simple value, range or vector, typically generated by <code>FlavorIterator</code> from &quot;flavors/DQMC/measurements/constructors/main.jl&quot;.</p><p>For each iteration, these iterators will produce a set of indices for the lattice and an index or set of indices for the flavor. These are then passed to the kernel, to evaluate the measurement for that configuration of sites and flavors. The result is then added to <code>measurement.temp</code> at another set of indices specified by the lattice iterator.</p><h3 id="Kernel-1"><a class="docs-heading-anchor" href="#Kernel-1">Kernel</a><a class="docs-heading-anchor-permalink" href="#Kernel-1" title="Permalink"></a></h3><p>The kernel is the final stage of a measurement. It essentially represents the Observable after Wicks theorem is applied, where expectation values of pairs of operators have been replaced by elements of the Greens function. On top of that there is some code to efficiently access the different matrix types present in MonteCarlo.jl</p><hr/><p>The point of having all of these different stages is to make measurements more adjustable. For example, one can adjust the lattice iterator to switch between getting a Matrix containing every <span>$\langle c_i c_j^\dagger \rangle$</span> or getting a vector, where matching <span>$r_i - r_j$</span> are summed.</p><h2 id="Restructure-1"><a class="docs-heading-anchor" href="#Restructure-1">Restructure</a><a class="docs-heading-anchor-permalink" href="#Restructure-1" title="Permalink"></a></h2><p>For some of the more verbose lattice iterators it is helpful to reorder the elements of the Greens function for fasting indexing. This is indicated by <code>Restructure</code> and done by <code>restructure!</code>. After this, the Greens function is indexed by with a site index and a directional index, rather than two site indices. Flavor indices remain unchanged through this process.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../dqmc_stacks/">« DQMC Stacks</a><a class="docs-footer-nextpage" href="../linalg/">Linear Algebra »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Friday 28 April 2023 11:17">Friday 28 April 2023</span>. Using Julia version 1.6.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
